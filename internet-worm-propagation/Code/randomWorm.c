#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>
#define simulation   3
#define simulationTime  1400
#define addressSpace     100000

enum nodeMode {empty,susceptible,infected};

//This method generates a random value between 0 and 1.
double randomGenerator(){
	double randomNum;
	randomNum = ( rand()+0.5 ) / ((RAND_MAX) + 1.0);
	return randomNum;
}

int main(void)
{
	int randomSeed, tick, min, max, infectedIp, prevInfectedIp;
	int scanRate = 2;
	int it[simulation][simulationTime];
	FILE *fp;
	enum nodeMode nodeStatus[addressSpace+1], priorNodeStatus[addressSpace+1];

	for(int sim=0; sim<3; sim++)
	{
		tick=0;
		infectedIp=1;

		for(int x=1; x<=addressSpace; x++)
		{
			nodeStatus[x]=empty;
		}

		for(int x=0; x<100; x++)
		{
			for(int y=1; y<=10; y++)
			{
				nodeStatus[y+x*1000]=susceptible;
			}
		}


		randomSeed=rand()%100000+1;
		nodeStatus[1] = infected;
		for(int x=0; x<addressSpace+1; x++)
		{
			priorNodeStatus[x] = nodeStatus[x];
		}
		prevInfectedIp = infectedIp;

		while(tick < simulationTime)
		{
			for(int i=1; i<=prevInfectedIp; i++)
			{
				for(int j=0; j<scanRate; j++){
					randomSeed=rand()%100000+1;
					if(priorNodeStatus[randomSeed]==susceptible && nodeStatus[randomSeed]!=infected)
					{
						nodeStatus[randomSeed]=infected;
						infectedIp++;
					}
				}
			}
			for(int i=0; i<addressSpace+1; i++)
			{
				priorNodeStatus[i] = nodeStatus[i];
			}
			prevInfectedIp = infectedIp;
			it[sim][tick] = infectedIp;
			tick++;
		}
	}

	fp=fopen("randomWormOutput.txt","wt");
	for(int i=0; i<simulationTime; i++)
	{
		for(int j=0; j<simulation; j++)
	
		fprintf(fp,"%d\t",it[j][i]);
		fprintf(fp,"\n");
	}
	fclose(fp);
   	return 0;

}
